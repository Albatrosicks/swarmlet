#!/usr/bin/env bash

set -eo pipefail; [[ $DEBUG ]] && set -x

deploy() {
  declare cmd="deploy"
  [[ "$1" == "$cmd" ]] && shift 1

  REPO_DEST=$1

  printenv
  echo $REPO_DEST

  # --config $SWARMLET_CONFIG
  docker run --rm \
    -v $REPO_DEST:$REPO_DEST \
    -v $DOCKER_SOCKET:$DOCKER_SOCKET \
    -v $SWARMLET_CONFIG:$SWARMLET_CONFIG:ro \
    $SWARMLET_REGISTRY/deployer \
    deploy $REPO_DEST
}

"$@"
