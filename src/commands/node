#!/usr/bin/env bash

set -eo pipefail
[[ $DEBUG ]] && set -x

node() {
  declare cmd="node"
  [[ "$1" == "$cmd" ]] && shift 1

  node-"$@"
}

node-ls() {
  declare cmd="ls"
  [[ "$1" == "$cmd" ]] && shift 1

  docker node ls --format "$PREFIX Hostname: {{.Hostname}}\n\
$PREFIX Manager status: {{.ManagerStatus}}\n\
$PREFIX Availability: {{.Availability}}\n\
$PREFIX Status: {{.Status}}\n\
$PREFIX Engine version: {{.EngineVersion}}"
}

node-join() {
  declare cmd="join"
  [[ "$1" == "$cmd" ]] && shift 1

  ROLE=$1

  echo "$FPREFIX Joining a $ROLE node to swarm"
  echo "$PREFIX To add a $ROLE to this swarm, run the following command on the target node:"

  pushd "$ANSIBLE_ROOT" >/dev/null
  echo

  python3 \
    "$SWARMLET_MODULES_ROOT/core/router/webhook/main.py" \
    "ansible-playbook add-host.yml -i inventory/inventory.yml --extra-vars 'host={host} address={address}'"
  # "ansible-playbook add-host.yml -i inventory/inventory.yml --extra-vars 'host={host} address={address} role=$ROLE'"

  echo
  echo "$PREFIX Waiting for remote.."
  popd >/dev/null
}

node-remove() {
  declare cmd="remove"
  [[ "$1" == "$cmd" ]] && shift 1

  # NODE_IP=$1
}

"$@"
